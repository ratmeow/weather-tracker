# Трекер погоды
Веб-приложение для просмотра текущей погоды.

## Функционал приложения
* Регистрация и авторизация пользователя
* Поиск локация по названию
* Добавление локаций в коллекцию пользователя и их удаление
* Отображение текущей погоды для каждой локации пользователя

## Архитектура проекта
Проект разделен на следующие слои.
  - domain - основная логика добавления и удаления локаций.
  - application - сценарии использования приложения(use_cases) и интерфейсы.
  - infrastructure - реализация интерфейсов слоя application; логика работы с хранилищем данных, хранилищем сессий и внешним API.
  - presentation - обработчики запросов пользователей
  - weather_tracker - агрегирует все слои, содержит конфигурацию приложения, контейнер зависимостей и точку входа.

## Запуск проекта
Склонировать репозиторий
Убедитесь, что у вас установлен docker
### Если нужно запустить все сервисы в контейнерах, а backend на хосте 

1. Для **(Windows, MacOS)** в файле `nginx.conf` установить переменной `proxy_pass` значение `http://host.docker.internal:8080/`

   Для **Linux** перед установкой переменной `proxy_pass` необходимо сначала добавить `extra_hosts` в сервис `nginx` в `docker-compose.yml`:
           `extra_hosts:
             - "host.docker.internal:host-gateway"`
2. Запустить сервисы `docker compose -f compose.dev.yaml up -d`
3. Установить зависимости `poetry install --only main`
4. Выполнить начальную миграцию `alembic upgrade head`
5. Запустить локальный backend `uvicorn weather_tracker.app:create_production_app --port 8080`
6. После этого backend сервиса будет доступен на `localhost:8080`, frontend `на localhost:3000`


### Если нужно запустить все сервисы в контейнерах 

1. Для **(Windows, MacOS)** в файле `nginx.conf` установить переменной `proxy_pass` значение `http://backend:8080/`

   Для **Linux** перед установкой переменной `proxy_pass` необходимо сначала добавить `extra_hosts` в сервис `nginx` в `docker-compose.yml`:
           `extra_hosts:
             - "host.docker.internal:host-gateway"`
2. Запустить сервисы `docker compose -f compose.prod.yaml up -d`
3. После этого бекенд будет доступен на `localhost:8080`, интерфейс `на localhost:3000`

## Тестирование
Были написаны unit тесты на основную логику каждого слоя приложения и интеграционные тесты для проверки работы всех уровней вместе.
Чтобы запустить все тесты, нужно убедиться, что файл test.env находится в корне проекта и содержит все необходимые переменные окружения.
Установить зависимости, необходимые для тестирования `poetry install --only test`
Выполнить `pytest tests`

## Codestyle
* В качестве линтера и форматера был использован **ruff**. Его конфиг можно найти в pyproject.toml 
* Код в директории `weather_tracker` был проверен с помощью **mypy**

### Стeк технологий backend
- FastAPI
- SQLAlchemy (asyncpg)
- Pydantic
- JWT Auth
- Docker
- PostgreSQL
- aiohttp
- Alembic